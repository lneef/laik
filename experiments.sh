#!/bin/bash

# to test other copy schemes, you need to adjust LAIK_SHMEM_COPY_SCHEME, for huge pages use LAIK_SHMEM_HUGE_PAGES=1 (1-copy, 2-copy)
# use export OMPI_MCA_btl_vader_single_copy_mechanism=none to disable single copy for OpenMPI
# for OpenMP -fopenmp has to be added to the Makefile
# to use the blockwise partitioner for jac2d you need to adjust the respective source file

LAIK_BACKEND=mpi LAIK_SECONDARIES=SHMEM LAIK_SHMEM_COPY_SCHEME=0 mpirun --mca btl vader,self --map-by core -np 8 ./jac2d 10000 500

LAIK_BACKEND=mpi LAIK_SECONDARIES=SHMEM LAIK_SHMEM_COPY_SCHEME=0 mpirun --mca btl vade,self --map-by core -np 8 ./jac3d 500 500

LAIK_BACKEND=mpi LAIK_SECONDARIES=SHMEM,SHMEM LAIK_SHMEM_COPY_SCHEME=2,0 LAIK_SHMEM_AFFINITY=0,1 LAIK_SHMEM_CPU_SETS=111111111111111111111111111111111111000000000000000000000000000000000000111111111111111111111111111111111111000000000000000000000000000000000000,000000000000000000000000000000000000111111111111111111111111111111111111000000000000000000000000000000000000111111111111111111111111111111111111 mpirun -np 8 --mca btl vader,self --map-by numa --bind-to core ./jac2d 10000 500

LAIK_BACKEND=mpi LAIK_SECONDARIES=SHMEM LAIK_SHMEM_COPY_SCHEME=1 mpirun -np 4 --mca btl vader,self --map-by core ./ping_pong

LAIK_BACKEND=mpi LAIK_SECONDARIES=SHMEM LAIK_SHMEM_COPY_SCHEME=2 mpirun -np --mca btl vader, self --map-by core -np 8 ./markov2 1000000 20 100

LAIK_BACKEND=mpi LAIK_SECONDARIES=SHMEM LAIK_SHMEM_COPY_SCHEME=2 LAIK_SHMEM_AFFINITY=1 LAIK_SHMEM_CPU_SETS=111111111111111111111111111111111111000000000000000000000000000000000000111111111111111111111111111111111111000000000000000000000000000000000000,000000000000000000000000000000000000111111111111111111111111111111111111000000000000000000000000000000000000111111111111111111111111111111111111 mpirun -np 8 --mca btl vader,self --map-by numa --bind-to core ./markov2 1000000 20 100

LAIK_BACKEND=mpi mpirun --mca btl vader,self -np 8 --map-by core ./jac2d 10000 500
LAIK_BACKEND=mpi mpirun --mca btl tcp,self --mca btl_tcp_if_include eth0 -np 8 --map-by core ./jac2d 10000 500
